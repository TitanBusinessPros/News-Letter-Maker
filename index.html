<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Newsletter Builder â€” Test Link (with Export)</title>
  <style>
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, Roboto, Arial, sans-serif;background:#0b1020;color:#e6eef8}
    .wrap{display:flex;gap:18px;align-items:stretch;min-height:100vh;padding:18px}
    .sidebar{width:320px;background:#0f1726;border-radius:12px;padding:18px;border:1px solid #182033}
    .sidebar h2{margin:0 0 8px 0;font-size:18px}
    label{display:block;font-size:13px;color:#9fb0d6;margin-top:12px}
    input[type=text], select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #18233a;background:#071025;color:#e6eef8}
    textarea{min-height:80px;resize:vertical}
    .actions{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    button{cursor:pointer;border:0;padding:10px 12px;border-radius:8px;font-weight:700}
    .btn-test{background:linear-gradient(135deg,#06b6d4,#7c3aed);color:#061022}
    .btn-export{background:linear-gradient(135deg,#facc15,#f97316);color:#061022}
    .panel{flex:1;display:flex;flex-direction:column}
    .preview{background:#ffffff;color:#0b1222;border-radius:12px;padding:18px;overflow:auto;border:1px solid #dfe6f6}
    .email-shell{max-width:680px;margin:0 auto;background:#ffffff;border-radius:10px;overflow:hidden}
    .email-top{padding:28px 22px;text-align:center;color:#fff}
    .email-title{margin:0;font-size:22px;color:#071022}
    .email-sub{margin:8px 0 0;color:#475569}
    .email-cta{padding:22px 20px;text-align:center}
    .cta-btn{display:inline-block;padding:12px 22px;border-radius:8px;color:#fff;text-decoration:none;font-weight:800}
    .cta-paragraph{margin-top:12px;max-width:640px;margin-left:auto;margin-right:auto;color:#475569;line-height:1.6;white-space:normal;word-wrap:break-word}
    .email-footer{padding:18px 20px;text-align:center;color:#94a3b8;font-size:13px}
    @media (max-width:900px){.wrap{flex-direction:column;padding:12px}.sidebar{width:100%}.email-shell{width:100%}}
  </style>
</head>
<body>
  <div class="wrap">
    <aside class="sidebar" aria-label="Builder controls">
      <h2>Newsletter Builder</h2>
      <label>Headline
        <input id="headline" type="text" placeholder="Big news this week" value="Big news this week" />
      </label>
      <label>Subheadline
        <input id="subhead" type="text" placeholder="Short subheading" value="Short subheading" />
      </label>
      <label>CTA Text
        <input id="ctaText" type="text" placeholder="Read the article" value="Read the article" />
      </label>
      <label>CTA URL
        <input id="ctaUrl" type="text" placeholder="https://example.com/article" value="https://example.com/article" />
      </label>
      <label>Paragraph under CTA
        <textarea id="ctaParagraph">This is a short paragraph that appears under the CTA button. It wraps correctly and will not overflow the preview area.</textarea>
      </label>
      <label>Color theme
        <select id="theme">
          <option value="aurora">Aurora</option>
          <option value="blue">Blue</option>
          <option value="green">Green</option>
          <option value="sunset">Sunset</option>
          <option value="steel">Steel</option>
        </select>
      </label>
      <label>Unsubscribe link
        <input id="unsubscribe" type="text" value="https://example.com/unsubscribe" />
      </label>
      <div class="actions">
        <button class="btn-test" id="getLink">Get Test Link</button>
        <button class="btn-export" id="exportBtn">Export HTML</button>
      </div>
    </aside>
    <section class="panel">
      <div class="preview" id="previewArea"></div>
    </section>
  </div>
  <script>
    const headlineInput=document.getElementById('headline');
    const subheadInput=document.getElementById('subhead');
    const ctaTextInput=document.getElementById('ctaText');
    const ctaUrlInput=document.getElementById('ctaUrl');
    const ctaParagraphInput=document.getElementById('ctaParagraph');
    const themeSelect=document.getElementById('theme');
    const unsubscribeInput=document.getElementById('unsubscribe');
    const previewArea=document.getElementById('previewArea');

    const THEMES={aurora:{top:'#7c3aed',cta:'#06b6d4'},blue:{top:'#2563eb',cta:'#3b82f6'},green:{top:'#16a34a',cta:'#22c55e'},sunset:{top:'#fb923c',cta:'#ef4444'},steel:{top:'#64748b',cta:'#94a3b8'}};

    function escapeHtml(str){if(!str)return'';return String(str).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\'':'&#39;'}[m]));}
    function escapeAttr(str){return escapeHtml(str).replace(/\"/g,'%22');}

    function buildHtml(){
      const t=THEMES[themeSelect.value]||THEMES.aurora;
      return `<!doctype html><html><head><meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"><title>${escapeHtml(headlineInput.value)}</title></head><body style=\"margin:0;padding:20px;background:${t.top};font-family:Arial,sans-serif;\"><table role=\"presentation\" width=\"100%\"><tr><td align=\"center\"><table role=\"presentation\" width=\"640\" style=\"max-width:100%;background:#fff;border-radius:10px\"><tr><td style=\"padding:28px 20px;text-align:center;background:${t.top};color:#fff\"><h1>${escapeHtml(headlineInput.value)}</h1><div>${escapeHtml(subheadInput.value)}</div></td></tr><tr><td style=\"padding:22px 20px;text-align:center\"><a href=\"${escapeAttr(ctaUrlInput.value)}\" style=\"display:inline-block;padding:12px 22px;border-radius:8px;background:${t.cta};color:#fff;text-decoration:none\">${escapeHtml(ctaTextInput.value)}</a><div style=\"margin-top:12px;color:#475569;line-height:1.6\">${escapeHtml(ctaParagraphInput.value)}</div></td></tr><tr><td style=\"padding:18px 20px;text-align:center;font-size:13px;color:#94a3b8\"><a href=\"${escapeAttr(unsubscribeInput.value)}\">Unsubscribe</a></td></tr></table></td></tr></table></body></html>`;
    }

    function render(){previewArea.innerHTML=buildHtml();}
    [headlineInput,subheadInput,ctaTextInput,ctaUrlInput,ctaParagraphInput,themeSelect,unsubscribeInput].forEach(el=>el.addEventListener('input',render));
    render();

    document.getElementById('getLink').addEventListener('click',()=>{
      const blob=new Blob([buildHtml()],{type:'text/html'});
      const url=URL.createObjectURL(blob);
      window.open(url,'_blank');
    });

    document.getElementById('exportBtn').addEventListener('click',()=>{
      const blob=new Blob([buildHtml()],{type:'text/html'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download='newsletter.html';
      a.click();
    });
  </script>
</body>
</html>
